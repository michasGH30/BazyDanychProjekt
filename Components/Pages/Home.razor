@page "/"
@inject HttpClient httpClient
@inject NavigationManager navigationManager

<PageTitle>Home</PageTitle>

@if (render)
{
    <h1>Hello, world!</h1>

    <p>Welcome to your new app.</p>

    @foreach(User u in usersResponse.Users)
    {
        <div>
            <p>email: @u.Email</p>
        </div>
    }

}
else
{
    <p>Loading...</p>
}

@code
{
    bool render = false;

    AllUsersResponse usersResponse = new();

    protected override async Task OnInitializedAsync()
    {
        var response = await httpClient.GetFromJsonAsync<LoginResponse>("/api/login");

        if (response != null)
        {
            if (!response.Success)
            {
                navigationManager.NavigateTo("/login");
            }
            else
            {
                usersResponse = await httpClient.GetFromJsonAsync<AllUsersResponse>("/api/user");
                render = true;
            }
        }

    }
}
